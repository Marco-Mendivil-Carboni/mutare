\documentclass[a4paper,10pt,twocolumn]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

\usepackage[backend=biber]{biblatex}
\addbibresource{references.bib}

\usepackage{lmodern}

\usepackage[margin=2cm]{geometry}

\usepackage{mathtools,amssymb}

\usepackage{graphicx}
\usepackage{xcolor}

\usepackage[hidelinks,pdfusetitle]{hyperref}

\title{Notes on project \emph{mutare}}
\author{Marco Mend√≠vil Carboni}

\begin{document}

\maketitle

\section{Introduction and objectives} \label{sec:introduction}

Adaptation in fluctuating environments is a central problem in evolutionary biology \cite{dinisPhaseTransitionsOptimal2020}. Natural populations rarely experience constant conditions: rather, they face environments that change unpredictably over time, often on ecological or evolutionary timescales. In such contexts, the success of a population depends not only on the intrinsic fitness of individual phenotypes but also on their ability to persist and reproduce across variable conditions.

A classical view of evolution suggests that populations tend to evolve toward the strategy that maximizes their mean growth rate $\langle\mu\rangle$ (also called fitness). However, when environmental fluctuations are strong and extinction risk is non-negligible, selection may favor strategies that sacrifice some fitness in exchange for a lower extinction rate $r_e$.

The purpose of this work is to investigate, through numerical simulations, how adaptation in uncertain environments gives rise to phenotypic diversity and whether the strategies that emerge correspond to those of maximal fitness or to safer, more resilient alternatives. The tool \emph{mutare} provides a framework to simulate and analyze such evolutionary dynamics with a simple stochastic model that we will describe in the next section.

\section{The model: a Markov process} \label{sec:model}

We consider a population with an initial number of agents $N_i$ evolving in an environment that fluctuates randomly over time. The \emph{environment} is modeled as a discrete variable with $n_{\text{env}}$ possible states, denoted by $e\in\{0,\dots,n_{\text{env}}-1\}$, which evolve according to a continuous-time Markov chain with transition rates $\omega_t(e,e')$ between states $e$ and $e'$.

Each agent is characterized by a \emph{phenotype} $\phi\in\{0,\dots,n_{\text{phe}}-1\}$ and a \emph{phenotypic strategy} $s(\phi)$, which represents a probability distribution (see \autoref{eq:phenotypic_strategy}) over the possible phenotypes:
\begin{equation} \label{eq:phenotypic_strategy}
    \sum_{\phi=0}^{n_{\text{phe}}-1}s(\phi) = 1.
\end{equation}
The phenotypic strategy determines the phenotype of the offspring, introducing a mechanism for stochastic phenotype switching between generations.

Population dynamics occur through stochastic birth and death processes that depend on both the current environment and the phenotype of the agent. The matrices $\omega_b(e,\phi)$ and $\omega_d(e,\phi)$ denote the birth and death rates of phenotype $\phi$ in environment $e$, respectively. The net growth rate in a given environment thus depends on the phenotypic composition of the population.

When an agent reproduces, its offspring inherits the parent's phenotypic strategy $s(\phi)$, but with probability $p_{\text{mut}}$ a mutation occurs, leading to a new random strategy. This mechanism allows for evolutionary exploration of the space of possible strategies.

The total population size is capped at the initial value $N_i$: whenever reproduction would cause the population to exceed this value, a random agent is removed. This mimics a form of ecological carrying capacity. If the population goes extinct, it is reinitialized, allowing for long-term statistical characterization of the dynamics.

During the simulation, several observables are measured, including the average population growth rate $\langle\mu\rangle$, the extinction rate $r_e$, and the distribution of phenotypic strategies $p(s(0))$. These quantities provide insight into whether evolution favors the maximization of mean fitness, the minimization of extinction risk, or the emergence of mixed strategies balancing both goals.

\section{Results: phenotypic diversity and safe strategies} \label{sec:results}

In \autoref{fig:symmetric_strat_phe_0}, \autoref{fig:symmetric_prob_mut} and \autoref{fig:symmetric_n_agents} we show the results for the following \emph{symmetric} parameters:
\begin{itemize}
    \item $n_{\text{env}}=2$, $n_{\text{phe}}=2$
    \item $\omega_t(e,e')=\begin{pmatrix}-1.0&+1.0\\+1.0&-1.0\end{pmatrix}$
    \item $\omega_b(e,\phi)=\begin{pmatrix}1.2&0.0\\0.0&0.8\end{pmatrix}$
    \item $\omega_d(e,\phi)=\begin{pmatrix}0.0&1.0\\1.0&0.0\end{pmatrix}$
    \item $p_{\text{mut}}=0.001$
    \item $N_i=100$
\end{itemize}

In these figures we show the results of three kinds of simulations: \texttt{fixed} (all agents share a prescribed, non-evolving strategy, $p_{\text{mut}}$ is set to $0$ in this case), \texttt{evolutive} (the initial population is monomorphic and strategies evolve by mutation and selection), and \texttt{random} (each agent begins with an independent random strategy that will evolve like in the previous case). In all the panels where they appear, the dotted lines mark the extinction-minimizing strategy and the dash-dot lines mark the growth-maximizing strategy, serving as visual references for comparison.

In \autoref{fig:asymmetric_strat_phe_0}, \autoref{fig:asymmetric_prob_mut} and \autoref{fig:asymmetric_n_agents} we show the results for the following \emph{asymmetric} parameters:
\begin{itemize}
    \item $\omega_b(e,\phi)=\begin{pmatrix}1.0&0.2\\0.0&0.0\end{pmatrix}$
    \item $\omega_d(e,\phi)=\begin{pmatrix}0.0&0.0\\1.0&0.1\end{pmatrix}$
    \item The rest of the parameters have the same values as in the \emph{symmetric} parameters.
\end{itemize}

For the parameter sets analyzed here, the fixed-strategy simulations (i.e., without evolution) show that in general the strategies that maximize mean growth rate and those that minimize extinction rate are different (see the growth and extinction panels in \autoref{fig:symmetric_strat_phe_0} and \autoref{fig:asymmetric_strat_phe_0}). In both the symmetric and asymmetric cases, the growth-optimal strategy is a mixed one, with nonzero fractions of both phenotypes. This reflects that, for these specific parameters, phenotypic diversity can increase the long-term growth rate. By contrast, the extinction-minimizing strategies differ: in the symmetric case, extinction is lowest for a balanced mixture, whereas in the asymmetric case it is minimized by a nearly pure phenotype-1 population.

It is important to emphasize that the appearance of mixed optimal strategies (bet hedging) is not general across all possible parameters, but rather a feature of the particular parameter choices used here, selected precisely because they allow the study of trade-offs between growth maximization and extinction avoidance.

We must clarify that in the average-strategy plots, the error bands represent the instantaneous dispersion of strategies across agents, not the dispersion accumulated over time. This dispersion remains small throughout all these simulations, implying that at any moment the population is almost monomorphic, even though mutation-driven exploration over long times is broad (see distribution panels in \autoref{fig:symmetric_strat_phe_0} and \autoref{fig:asymmetric_strat_phe_0}). This justifies comparing the \texttt{evolutive} and \texttt{random} simulations directly with the \texttt{fixed} simulations.

In \autoref{fig:extended_strat_phe_0} we show the results for the following \emph{extended} parameters:
\begin{itemize}
    \item $N_i=1000$
    \item The rest of the parameters have the same values as in the \emph{asymmetric} parameters.
\end{itemize}

When evolution is enabled, the system converges to a well-defined stationary strategy regardless of the initial distribution of strategies. As shown in the average-strategy panels of \autoref{fig:symmetric_strat_phe_0}, \autoref{fig:asymmetric_strat_phe_0} and \autoref{fig:extended_strat_phe_0}, both monomorphic and randomly initialized populations evolve toward the same average strategy and long-term distribution. This indicates a stable attractor in strategy space.

Finally, the nature of the evolved strategy depends strongly on population size and the corresponding extinction risk. In the extended simulations (\autoref{fig:extended_strat_phe_0}), where population size is large and extinction is rare, evolution converges to the growth-maximizing strategy (as expected from standard evolutionary theory). In contrast, smaller populations with higher extinction risk (see \autoref{fig:symmetric_n_agents} and \autoref{fig:asymmetric_n_agents}) evolve toward safer strategies with lower extinction, even when this requires sacrificing growth. This reveals a clear bias towards risk-reducing strategies as extinction risk increases.

The remaining four figures (\autoref{fig:symmetric_prob_mut}, \autoref{fig:symmetric_n_agents}, \autoref{fig:asymmetric_prob_mut} and \autoref{fig:asymmetric_n_agents}) illustrate how the evolutionary outcome (starting from a random initial condition) changes when we vary either the mutation probability or the population size.

The effect of changing the number of agents (\autoref{fig:symmetric_n_agents} and \autoref{fig:asymmetric_n_agents}) behaves as expected. As the (maximum) population size $N_i$ increases, the evolved $\langle s(0)\rangle$ approaches the growth-maximizing value obtained from the fixed-strategy simulations. Likewise, the distribution of strategies explored over long evolutionary time becomes increasingly concentrated. A somewhat counterintuitive effect appears in the instantaneous dispersion: although the long-term distribution tightens with increasing $N_i$, the instantaneous dispersion increases slightly. This occurs because larger populations allow multiple very similar strategies to coexist for longer periods without being lost by drift, i.e. in small populations, nearly identical strategies tend to go extinct rapidly and only one survives at any moment. All other panels in these figures follow directly from this behavior.

Changing the mutation probability (\autoref{fig:symmetric_prob_mut} and \autoref{fig:asymmetric_prob_mut}) produces a richer and less intuitive set of behaviors. For very large mutation probabilities (close to $1$), the biological relevance is limited, but the dynamics are clear: the population behaves almost as if fully randomized each generation. Both phenotypes appear with approximately $50\%$ frequency throughout the simulation, and the instantaneous dispersion is correspondingly extremely large. In this regime, the results essentially reproduce those of a fixed strategy with a 50--50 phenotype mixture.

As the mutation probability decreases, we enter the regime around our reference value $p_{\text{mut}}=10^{-3}$. Here the instantaneous dispersion collapses: the population becomes effectively monomorphic at each time step. Correspondingly, the average strategy moves away from the 50--50 baseline and seemingly approaches the growth-maximizing value. However, this tendency quickly changes:  $\langle s(0)\rangle$ reaches a maximum at moderate mutation probabilities and then decreases again as $p_{\text{mut}}$ is further reduced.

For even smaller mutation probabilities, the system enters a regime in which mutations are so rare that almost none occur before extinction is reached. In this limit, the observed outcome is no longer determined by evolutionary adaptation but rather by selection among the $N_i$ randomly assigned initial strategies. In the symmetric case, the limiting value of $\langle s(0)\rangle$ lies close to $0.5$, which coincides with the minimum-extinction strategy (although this may be coincidental), and in the asymmetric case, is a little lower at around $0.4$.

In addition to the strategy-related observables discussed above, two further quantities provide complementary insight into the underlying evolutionary and ecological dynamics: (i) the distribution of the normalized population size $N/N_i$ during the simulations, and (ii) the distribution of actual phenotypes present in the population at each time step.

Across all parameter regimes explored, the distribution of $N/N_i$ exhibits a dominant peak at $1$, indicating that populations typically remain close to the carrying capacity. This reflects that the average long-term growth rate is positive under all strategies visited during the simulations. The informative part of the distribution lies in its tail, which broadens systematically as extinction risk increases. Wider tails imply more frequent or deeper demographic bottlenecks, consistent with the interpretation that populations experiencing a higher extinction rate also undergo larger fluctuations in size.

The structure of this tail reveals additional dynamical information. In the symmetric parameter set, the population-size distribution develops a secondary maximum whose location varies with the underlying strategy. This secondary peak approaches zero for strategies dominated by a phenotype maladapted to the currently unfavorable environment, rises toward values close to $1$ when there is always a significant proportion of agents adapted to each environment, and returns to zero as the strategy shifts further.

In contrast, under the asymmetric parameters the secondary peak instead shifts monotonically from $0$ to $1$ as the strategy moves from the ``risky'' phentoype to the ``safe'' one. This is consistent with the fact that committing to the safe phenotype prevents severe population declines, whereas betting entirely on the environmentally fragile phenotype leads to repeated near-extinction events whenever the environment turns unfavorable. An intriguing effect, which we do not yet fully understand, is that the height of the secondary peak relative to the main peak tends to decrease as the population size $N_i$ increases.

The second observable concerns the actual distribution of phenotypes present in the population at each time, which in general does not coincide with the underlying phenotypic strategy. This discrepancy is substantial in the asymmetric case. The mismatch arises because the realized phenotype frequencies respond directly to differential birth and death rates in each environment, whereas the strategy specifies only the probabilities with which phenotypes are produced at reproduction.

It is also important to compare this observable to the theoretical equilibrium distributions obtained from the dominant eigenvector of the environment dependent birth and death matrices for a fixed strategy. For any fixed strategy and fixed environment $e$, this eigenvector gives the expected stable composition of phenotypes in a large population in the absence of stochasticity. As expected, the actual phenotype distribution observed in simulations always lies between the theoretical equilibrium lines corresponding to the two environments. These equilibrium curves appear nearly linear functions of the strategy (and may indeed be analytically linear for this class of models, it is left as an excercise for the reader).

\printbibliography

\begin{figure*}[p]
    \centering
    \caption{Results for the symmetric parameters with different initial strategies.} \label{fig:symmetric_strat_phe_0}
    \includegraphics{../sims/symmetric/plots/strat_phe_0/growth_rate.pdf}
    \includegraphics{../sims/symmetric/plots/strat_phe_0/extinct_rate.pdf}
    \includegraphics{../sims/symmetric/plots/strat_phe_0/rates.pdf}
    \includegraphics{../sims/symmetric/plots/strat_phe_0/dist_n_agents.pdf}
    \includegraphics{../sims/symmetric/plots/strat_phe_0/dist_strat_phe_0.pdf}
    \includegraphics{../sims/symmetric/plots/strat_phe_0/avg_strat_phe_0.pdf}
    \includegraphics{../sims/symmetric/plots/strat_phe_0/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the symmetric parameters with different mutation probabilities.} \label{fig:symmetric_prob_mut}
    \includegraphics{../sims/symmetric/plots/prob_mut/growth_rate.pdf}
    \includegraphics{../sims/symmetric/plots/prob_mut/extinct_rate.pdf}
    \includegraphics{../sims/symmetric/plots/prob_mut/rates.pdf}
    \includegraphics{../sims/symmetric/plots/prob_mut/dist_n_agents.pdf}
    \includegraphics{../sims/symmetric/plots/prob_mut/dist_strat_phe_0.pdf}
    \includegraphics{../sims/symmetric/plots/prob_mut/avg_strat_phe_0.pdf}
    \includegraphics{../sims/symmetric/plots/prob_mut/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the symmetric parameters with different numbers of agents.} \label{fig:symmetric_n_agents}
    \includegraphics{../sims/symmetric/plots/n_agents/growth_rate.pdf}
    \includegraphics{../sims/symmetric/plots/n_agents/extinct_rate.pdf}
    \includegraphics{../sims/symmetric/plots/n_agents/rates.pdf}
    \includegraphics{../sims/symmetric/plots/n_agents/dist_n_agents.pdf}
    \includegraphics{../sims/symmetric/plots/n_agents/dist_strat_phe_0.pdf}
    \includegraphics{../sims/symmetric/plots/n_agents/avg_strat_phe_0.pdf}
    \includegraphics{../sims/symmetric/plots/n_agents/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the symmetric parameters as a function of time.} \label{fig:symmetric_time_series}
    \includegraphics{../sims/symmetric/plots/time_series/n_agents.pdf}
    \includegraphics{../sims/symmetric/plots/time_series/avg_strat_phe_0.pdf}
    \includegraphics{../sims/symmetric/plots/time_series/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the asymmetric parameters with different initial strategies.} \label{fig:asymmetric_strat_phe_0}
    \includegraphics{../sims/asymmetric/plots/strat_phe_0/growth_rate.pdf}
    \includegraphics{../sims/asymmetric/plots/strat_phe_0/extinct_rate.pdf}
    \includegraphics{../sims/asymmetric/plots/strat_phe_0/rates.pdf}
    \includegraphics{../sims/asymmetric/plots/strat_phe_0/dist_n_agents.pdf}
    \includegraphics{../sims/asymmetric/plots/strat_phe_0/dist_strat_phe_0.pdf}
    \includegraphics{../sims/asymmetric/plots/strat_phe_0/avg_strat_phe_0.pdf}
    \includegraphics{../sims/asymmetric/plots/strat_phe_0/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the asymmetric parameters with different mutation probabilities.} \label{fig:asymmetric_prob_mut}
    \includegraphics{../sims/asymmetric/plots/prob_mut/growth_rate.pdf}
    \includegraphics{../sims/asymmetric/plots/prob_mut/extinct_rate.pdf}
    \includegraphics{../sims/asymmetric/plots/prob_mut/rates.pdf}
    \includegraphics{../sims/asymmetric/plots/prob_mut/dist_n_agents.pdf}
    \includegraphics{../sims/asymmetric/plots/prob_mut/dist_strat_phe_0.pdf}
    \includegraphics{../sims/asymmetric/plots/prob_mut/avg_strat_phe_0.pdf}
    \includegraphics{../sims/asymmetric/plots/prob_mut/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the asymmetric parameters with different numbers of agents.} \label{fig:asymmetric_n_agents}
    \includegraphics{../sims/asymmetric/plots/n_agents/growth_rate.pdf}
    \includegraphics{../sims/asymmetric/plots/n_agents/extinct_rate.pdf}
    \includegraphics{../sims/asymmetric/plots/n_agents/rates.pdf}
    \includegraphics{../sims/asymmetric/plots/n_agents/dist_n_agents.pdf}
    \includegraphics{../sims/asymmetric/plots/n_agents/dist_strat_phe_0.pdf}
    \includegraphics{../sims/asymmetric/plots/n_agents/avg_strat_phe_0.pdf}
    \includegraphics{../sims/asymmetric/plots/n_agents/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the asymmetric parameters as a function of time.} \label{fig:ssymmetric_time_series}
    \includegraphics{../sims/asymmetric/plots/time_series/n_agents.pdf}
    \includegraphics{../sims/asymmetric/plots/time_series/avg_strat_phe_0.pdf}
    \includegraphics{../sims/asymmetric/plots/time_series/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}
    \centering
    \caption{Results for the extended parameters with different initial strategies.} \label{fig:extended_strat_phe_0}
    \includegraphics{../sims/extended/plots/strat_phe_0/growth_rate.pdf}
    \includegraphics{../sims/extended/plots/strat_phe_0/extinct_rate.pdf}
    \includegraphics{../sims/extended/plots/strat_phe_0/rates.pdf}
    \includegraphics{../sims/extended/plots/strat_phe_0/dist_n_agents.pdf}
    \includegraphics{../sims/extended/plots/strat_phe_0/dist_strat_phe_0.pdf}
    \includegraphics{../sims/extended/plots/strat_phe_0/avg_strat_phe_0.pdf}
    \includegraphics{../sims/extended/plots/strat_phe_0/dist_phe_0.pdf}
\end{figure*}

\begin{figure*}[p]
    \centering
    \caption{Results for the extended parameters as a function of time.} \label{fig:extended_time_series}
    \includegraphics{../sims/extended/plots/time_series/n_agents.pdf}
    \includegraphics{../sims/extended/plots/time_series/avg_strat_phe_0.pdf}
    \includegraphics{../sims/extended/plots/time_series/dist_phe_0.pdf}
\end{figure*}

\end{document}
